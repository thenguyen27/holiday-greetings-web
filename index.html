<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thiệp Chúc Mừng 20/10 💕</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Quicksand", sans-serif;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        -webkit-tap-highlight-color: transparent;
      }
      .background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: linear-gradient(
          135deg,
          #ffc9e0 0%,
          #e8d4f8 25%,
          #c8e3ff 50%,
          #e8d4f8 75%,
          #ffc9e0 100%
        );
        background-size: 400% 400%;
      }
      .background::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(255, 182, 193, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(200, 180, 255, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 20%,
            rgba(255, 200, 220, 0.2) 0%,
            transparent 40%
          );
        animation: pulseGlow 8s ease-in-out infinite;
      }
      @keyframes pulseGlow {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
      }
      .background::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle,
          transparent 20%,
          rgba(0, 0, 0, 0.05) 100%
        );
      }
      .particles-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      }
      .light-particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.9),
          transparent
        );
        border-radius: 50%;
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
      }
      .hearts-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }
      .heart {
        position: absolute;
        filter: drop-shadow(0 0 12px rgba(255, 90, 139, 0.5));
      }
      .bicycle-container {
        position: fixed;
        bottom: 35%;
        left: -300px;
        z-index: 5;
        opacity: 0;
      }
      .bicycle-container img {
        height: 180px;
        width: auto;
        filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.25));
      }
      .container {
        position: relative;
        z-index: 10;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 30px;
        opacity: 0;
        pointer-events: none;
      }
      .greeting-text {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: "Dancing Script", cursive;
        font-size: clamp(32px, 8vw, 64px);
        font-weight: 700;
        -webkit-background-clip: text;
        background-clip: text;
        text-align: center;
        z-index: 50;
        opacity: 0;
        pointer-events: none;
        filter: drop-shadow(0 4px 20px rgba(255, 90, 139, 0.4));
        letter-spacing: 2px;
        line-height: 1.6;
        padding: 0 20px;
        max-width: 90vw;
      }
      .hint-text {
        font-family: "Quicksand", sans-serif;
        font-size: clamp(14px, 3vw, 18px);
        color: #ff5a8b;
        text-align: center;
        margin-bottom: 15px;
        opacity: 0;
        font-weight: 600;
        letter-spacing: 0.5px;
        text-shadow: 0 2px 10px rgba(255, 90, 139, 0.3);
      }
      .thank-you {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: "Dancing Script", cursive;
        font-size: clamp(28px, 6vw, 48px);
        font-weight: 600;
        -webkit-background-clip: text;
        background-clip: text;
        text-align: center;
        z-index: 150;
        opacity: 0;
        pointer-events: none;
        filter: drop-shadow(0 4px 15px rgba(255, 90, 139, 0.4));
      }
      .music-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid #ffe0ea;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        z-index: 200;
        box-shadow: 0 4px 15px rgba(255, 90, 139, 0.2);
        opacity: 0;
        touch-action: manipulation;
        transition: all 0.3s ease;
      }
      .music-toggle:hover {
        background: rgba(255, 240, 245, 1);
        box-shadow: 0 6px 20px rgba(255, 90, 139, 0.4);
        transform: scale(1.05);
      }
      .music-toggle.muted {
        opacity: 0.6;
        background: rgba(220, 220, 220, 0.8);
      }
      .envelope-wrapper {
        position: relative;
        width: min(85vw, 400px);
        height: min(55vw, 280px);
        cursor: pointer;
        filter: drop-shadow(0 15px 50px rgba(255, 90, 139, 0.3));
        touch-action: manipulation;
        transition: filter 0.3s ease;
      }
      .envelope-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 450px;
        height: 450px;
        background: radial-gradient(
          circle,
          rgba(255, 182, 193, 0.6) 0%,
          rgba(255, 182, 193, 0.4) 30%,
          rgba(255, 192, 203, 0.2) 50%,
          transparent 70%
        );
        filter: blur(60px);
        z-index: -1;
        opacity: 0.7;
      }
      .envelope {
        width: 100%;
        height: 100%;
      }
      .card-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: -1;
        opacity: 0;
        pointer-events: none;
        backdrop-filter: blur(0px);
      }
      .large-card {
        position: relative;
        width: min(92vw, 700px);
        max-height: 80vh;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.98) 0%,
          rgba(255, 250, 252, 0.98) 100%
        );
        backdrop-filter: blur(30px);
        border-radius: 25px;
        box-shadow: 0 25px 100px rgba(255, 90, 139, 0.35),
          0 10px 30px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(255, 255, 255, 0.9);
        padding: clamp(30px, 5vw, 50px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow-y: auto;
        opacity: 0;
        transform: scale(0.5);
        -webkit-overflow-scrolling: touch;
      }
      .flowers-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: hidden;
      }
      .flower {
        position: absolute;
        opacity: 0;
      }
      .card-decoration {
        position: absolute;
        opacity: 0.15;
        z-index: 0;
      }
      .card-decoration.top-left {
        top: 20px;
        left: 20px;
      }
      .card-decoration.top-right {
        top: 20px;
        right: 20px;
        transform: scaleX(-1);
      }
      .card-decoration.bottom-left {
        bottom: 20px;
        left: 20px;
        transform: scaleY(-1);
      }
      .card-decoration.bottom-right {
        bottom: 20px;
        right: 20px;
        transform: scale(-1);
      }
      .large-card-content {
        position: relative;
        text-align: center;
        font-size: clamp(18px, 4vw, 28px);
        line-height: 2.2;
        color: #2d2d2d;
        font-weight: 400;
        letter-spacing: 0.5px;
        z-index: 1;
        max-width: 600px;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      .typewriter-text {
        white-space: pre-wrap;
        word-wrap: break-word;
        -webkit-background-clip: text;
        background-clip: text;
        font-weight: 500;
      }
      .cursor {
        display: inline-block;
        width: 3px;
        height: 1.2em;
        background: linear-gradient(180deg, #ff5a8b 0%, #ff8fab 100%);
        margin-left: 3px;
        vertical-align: middle;
        box-shadow: 0 0 10px rgba(255, 90, 139, 0.5);
      }
      .close-button {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 44px;
        height: 44px;
        background: linear-gradient(135deg, #ff5a8b 0%, #ff8fab 100%);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(255, 90, 139, 0.4);
        z-index: 10;
        opacity: 0;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        transition: all 0.3s ease;
      }
      .close-button:hover {
        transform: rotate(90deg);
        box-shadow: 0 6px 20px rgba(255, 90, 139, 0.6);
      }
      .open-button {
        padding: 16px 42px;
        background: linear-gradient(135deg, #ff5a8b 0%, #ff8fab 100%);
        color: white;
        border: none;
        border-radius: 50px;
        font-family: "Dancing Script", cursive;
        font-size: clamp(16px, 4vw, 20px);
        font-weight: 700;
        cursor: pointer;
        box-shadow: rgba(0, 0, 0, 0.4) 0px 2px 4px,
          rgba(0, 0, 0, 0.3) 0px 7px 13px -3px,
          rgba(0, 0, 0, 0.2) 0px -3px 0px inset;
        letter-spacing: 1.5px;
        position: relative;
        overflow: hidden;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        min-height: 48px;
      }
      .open-button::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transform: rotate(45deg);
        animation: shimmer 3s infinite;
      }
      @keyframes shimmer {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) translateY(100%) rotate(45deg);
        }
      }
      .open-button span {
        position: relative;
        z-index: 1;
      }

      .open-button:hover {
        box-shadow: rgba(0, 0, 0, 0.4) 0px 2px 4px,
          rgba(0, 0, 0, 0.3) 0px 7px 13px -3px,
          rgba(0, 0, 0, 0.2) 0px -3px 0px inset;
        transform: translateY(-2px);
      }

      .envelope-flap {
        transform-origin: top center;
        transform-style: preserve-3d;
      }
      .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 20;
      }
      .particle {
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        opacity: 0;
      }
      .confetti {
        position: fixed;
        width: 12px;
        height: 12px;
        pointer-events: none;
        z-index: 100;
      }
      .message-selector {
        position: fixed;
        top: 70px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        border: 2px solid #ffe0ea;
        border-radius: 15px;
        padding: 12px;
        z-index: 200;
        opacity: 0;
        box-shadow: 0 4px 15px rgba(255, 90, 139, 0.2);
      }
      .message-selector select {
        padding: 8px 15px;
        border: 2px solid #ff8fab;
        border-radius: 10px;
        font-family: "Quicksand", sans-serif;
        font-weight: 600;
        color: #ff5a8b;
        background: white;
        cursor: pointer;
        outline: none;
        font-size: 14px;
      }
      .message-selector select:hover {
        background: #fff5f8;
        border-color: #ff5a8b;
      }
      .share-button {
        padding: 14px 36px;
        background: linear-gradient(135deg, #ff8fab 0%, #ffb3c6 100%);
        color: white;
        border: none;
        border-radius: 50px;
        font-family: "Dancing Script", cursive;
        font-size: clamp(15px, 3.5vw, 18px);
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(255, 90, 139, 0.3);
        letter-spacing: 1.2px;
        margin-top: 25px;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        min-height: 44px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
      }
      .share-button:hover {
        box-shadow: 0 10px 30px rgba(255, 90, 139, 0.5);
        transform: translateY(-2px);
      }
      @media (max-width: 768px) {
        .large-card {
          padding: 25px 20px;
          border-radius: 20px;
          width: 95vw;
          max-height: 75vh;
        }
        .open-button {
          padding: 14px 36px;
          font-size: 16px;
          min-height: 44px;
        }
        .large-card-content {
          font-size: clamp(17px, 4.5vw, 24px);
          line-height: 2;
        }
        .close-button {
          width: 40px;
          height: 40px;
          font-size: 24px;
        }
        .bicycle-container img {
          height: 140px;
        }
        .card-decoration {
          width: 60px;
          height: 60px;
        }
        .greeting-text {
          font-size: clamp(28px, 9vw, 52px);
        }
        .message-selector {
          top: 75px;
          right: 15px;
          padding: 10px;
        }
        .message-selector select {
          font-size: 12px;
          padding: 6px 12px;
        }
        .share-button {
          padding: 12px 30px;
          font-size: 14px;
        }
      }
      @media (max-width: 480px) {
        .large-card {
          padding: 20px 15px;
          max-height: 70vh;
        }
        .close-button {
          width: 36px;
          height: 36px;
          font-size: 22px;
        }
        .card-decoration {
          width: 50px;
          height: 50px;
          opacity: 0.1;
        }
        .bicycle-container img {
          height: 120px;
        }
      }

      .letter-signature {
        text-align: right;
        margin-top: 30px;
        font-family: "Dancing Script", cursive;
        font-size: clamp(20px, 4vw, 28px);
        color: var(--text-color);
        font-weight: 600;
      }

      /* 🌼 Responsive nâng cao cho mobile & tablet */
      @media (max-width: 1024px) {
        .greeting-text {
          font-size: clamp(28px, 7vw, 48px);
        }
        .hint-text {
          font-size: clamp(14px, 3.5vw, 17px);
        }
        .large-card {
          width: 90vw;
          max-height: 78vh;
        }
        .typewriter-text {
          font-size: clamp(17px, 4vw, 22px);
          line-height: 1.8;
        }
      }

      @media (max-width: 768px) {
        body {
          flex-direction: column;
          justify-content: flex-start;
          padding-top: 40px;
        }

        .envelope-wrapper {
          width: 80vw;
          height: 50vw;
        }

        .large-card {
          width: 92vw;
          max-height: 75vh;
          padding: 25px 20px;
          border-radius: 18px;
        }

        .large-card-content {
          padding: 10px;
          font-size: clamp(16px, 4.5vw, 20px);
          line-height: 2;
        }

        .letter-header {
          font-size: clamp(20px, 5vw, 28px);
          margin-bottom: 15px;
        }

        .letter-header span {
          color: var(--text-color);
        }

        .letter-signature {
          margin-top: 20px;
          font-size: clamp(18px, 4vw, 24px);
        }

        .open-button,
        .share-button {
          padding: 12px 32px;
          font-size: 16px;
        }

        .close-button {
          width: 38px;
          height: 38px;
          font-size: 22px;
        }

        .hint-text {
          padding: 0 20px;
          line-height: 1.6;
        }
      }

      @media (max-width: 540px) {
        .large-card {
          padding: 20px 15px;
          width: 95vw;
          max-height: 70vh;
        }

        .letter-body {
          padding: 0 6px;
        }

        .typewriter-text {
          font-size: clamp(15px, 4.5vw, 18px);
          line-height: 1.9;
          letter-spacing: 0.4px;
        }

        .letter-header {
          font-size: clamp(18px, 5vw, 22px);
        }

        .letter-signature {
          font-size: clamp(16px, 4vw, 20px);
        }

        .open-button,
        .share-button {
          padding: 10px 26px;
          font-size: 14px;
        }

        .close-button {
          width: 34px;
          height: 34px;
          font-size: 20px;
        }

        .hint-text {
          font-size: 14px;
          line-height: 1.5;
        }

        .greeting-text {
          font-size: clamp(24px, 8vw, 38px);
          line-height: 1.4;
        }

        .bicycle-container img {
          height: 120px;
        }
      }

      @media (max-width: 380px) {
        .typewriter-text {
          font-size: 15px;
          line-height: 1.7;
        }

        .letter-signature {
          font-size: 16px;
        }

        .hint-text {
          font-size: 13px;
        }

        .open-button {
          padding: 10px 24px;
          font-size: 13px;
        }

        .greeting-text {
          font-size: 26px;
        }
      }

      /* Giữ phần giữa cho mobile */
      @media (max-width: 768px) {
        .container {
          justify-content: center; /* Giữa theo chiều dọc */
          align-items: center;
          top: 0;
          transform: none;
          height: 100vh;
        }

        .large-card {
          max-height: 75vh;
          margin-top: auto;
          margin-bottom: auto;
        }

        .hint-text {
          position: relative;
          top: auto;
          transform: none;
          text-align: center;
        }
      }

      /* Giới hạn vùng trang trí quanh mép lá thư */
      .flowers-container,
      .particles-bg {
        pointer-events: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      /* Chỉ cho phép hoa xuất hiện quanh viền (không đè chữ giữa) */
      .flower {
        position: absolute;
        opacity: 0.85;
        z-index: 0;
        transform-origin: center;
      }

      .light-particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.9),
          transparent
        );
        border-radius: 50%;
        box-shadow: 0 0 12px rgba(255, 255, 255, 0.8);
        z-index: 0;
      }

      /* Tạo khoảng rỗng giữa nội dung và hoa */
      .large-card-content {
        position: relative;
        z-index: 5; /* luôn nằm trên */
        /* background: transparent; */
      }
    </style>
  </head>
  <body>
    <div class="background"></div>
    <div class="particles-bg" id="particlesBg"></div>
    <div class="hearts-container" id="heartsContainer"></div>
    <div class="particles" id="particlesContainer"></div>
    <div class="greeting-text" id="greetingText">Chào người đẹp! 💖</div>
    <div class="thank-you" id="thankYou">💗 Cảm ơn bạn đã đọc 💗</div>
    <!-- <button class="music-toggle" id="musicToggle" title="Bật/tắt nhạc">
      🎵
    </button> -->
    <div class="bicycle-container" id="bicycleContainer">
      <img
        src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExOXdsZDBvZmMxcW9senF4cWlrazl5aW9zZ3pyeGZkM2FsZXEyNWhsNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/W23haVmnrOuh1wsZt0/giphy.gif"
        alt="Xe đạp chở thư"
      />
    </div>
    <div class="container" id="mainContainer">
      <div class="envelope-glow" id="envelopeGlow"></div>
      <div class="hint-text" id="hintText">
        ✨ Có một điều nhỏ xíu muốn gửi đến bạn... ✨<br />💗 Hãy mở thư và nhận
        một chút yêu thương nhé 💗
      </div>
      <div class="envelope-wrapper" id="envelopeWrapper">
        <svg
          class="envelope"
          viewBox="0 0 400 280"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <linearGradient
              id="envelopeGradient"
              x1="0%"
              y1="0%"
              x2="100%"
              y2="100%"
            >
              <stop offset="0%" style="stop-color: #ffffff; stop-opacity: 1" />
              <stop
                offset="100%"
                style="stop-color: #fff5f8; stop-opacity: 1"
              />
            </linearGradient>
            <linearGradient id="flapGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color: #ffebf0; stop-opacity: 1" />
              <stop
                offset="100%"
                style="stop-color: #ffd6e0; stop-opacity: 1"
              />
            </linearGradient>
            <filter id="shadow">
              <feDropShadow
                dx="0"
                dy="4"
                stdDeviation="8"
                flood-color="#ff5a8b"
                flood-opacity="0.2"
              />
            </filter>
          </defs>
          <rect
            x="20"
            y="60"
            width="360"
            height="200"
            fill="url(#envelopeGradient)"
            stroke="#ffe0ea"
            stroke-width="2"
            rx="12"
            filter="url(#shadow)"
          />
          <pattern
            id="dotsPattern"
            x="0"
            y="0"
            width="20"
            height="20"
            patternUnits="userSpaceOnUse"
          >
            <circle cx="10" cy="10" r="1" fill="#ffc0d3" opacity="0.3" />
          </pattern>
          <rect
            x="20"
            y="60"
            width="360"
            height="200"
            fill="url(#dotsPattern)"
            rx="12"
          />
          <path
            d="M 20 60 L 200 160 L 380 60"
            fill="#fafafa"
            stroke="#ffe0ea"
            stroke-width="2"
          />
          <g class="envelope-flap" id="envelopeFlap">
            <path
              d="M 20 60 L 200 160 L 380 60 L 200 60 Z"
              fill="url(#flapGradient)"
              stroke="#ffe0ea"
              stroke-width="2"
            />
            <line
              x1="20"
              y1="60"
              x2="200"
              y2="160"
              stroke="#ffc0d3"
              stroke-width="1.5"
              opacity="0.4"
            />
            <line
              x1="380"
              y1="60"
              x2="200"
              y2="160"
              stroke="#ffc0d3"
              stroke-width="1.5"
              opacity="0.4"
            />
            <g transform="translate(200, 95)" id="heartSeal">
              <circle r="18" fill="#ff5a8b" opacity="0.9" />
              <path
                d="M 0,-6 C -3,-9 -8,-9 -10,-6 C -12,-3 -12,0 -10,3 L 0,12 L 10,3 C 12,0 12,-3 10,-6 C 8,-9 3,-9 0,-6 Z"
                fill="#ffffff"
                opacity="0.9"
              />
            </g>
          </g>
        </svg>
      </div>
      <button class="open-button" id="openButton">
        <span>✨ Mở Thư ✨</span>
      </button>
    </div>
    <div class="card-overlay" id="cardOverlay">
      <div class="large-card" id="largeCard">
        <div class="flowers-container" id="flowersContainer"></div>
        <svg
          class="card-decoration top-left"
          width="80"
          height="80"
          viewBox="0 0 80 80"
        >
          <path
            d="M 10,10 Q 40,10 40,40 Q 40,10 70,10"
            stroke="#ff5a8b"
            stroke-width="2"
            fill="none"
          />
          <circle cx="10" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="40" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="70" cy="10" r="4" fill="#ff5a8b" />
        </svg>
        <svg
          class="card-decoration top-right"
          width="80"
          height="80"
          viewBox="0 0 80 80"
        >
          <path
            d="M 10,10 Q 40,10 40,40 Q 40,10 70,10"
            stroke="#ff5a8b"
            stroke-width="2"
            fill="none"
          />
          <circle cx="10" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="40" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="70" cy="10" r="4" fill="#ff5a8b" />
        </svg>
        <svg
          class="card-decoration bottom-left"
          width="80"
          height="80"
          viewBox="0 0 80 80"
        >
          <path
            d="M 10,10 Q 40,10 40,40 Q 40,10 70,10"
            stroke="#ff5a8b"
            stroke-width="2"
            fill="none"
          />
          <circle cx="10" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="40" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="70" cy="10" r="4" fill="#ff5a8b" />
        </svg>
        <svg
          class="card-decoration bottom-right"
          width="80"
          height="80"
          viewBox="0 0 80 80"
        >
          <path
            d="M 10,10 Q 40,10 40,40 Q 40,10 70,10"
            stroke="#ff5a8b"
            stroke-width="2"
            fill="none"
          />
          <circle cx="10" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="40" cy="10" r="4" fill="#ff5a8b" />
          <circle cx="70" cy="10" r="4" fill="#ff5a8b" />
        </svg>
        <button class="close-button" id="closeButton">×</button>
        <div class="large-card-content">
          <div class="letter">
            <div class="letter-header" id="letterHeader"></div>
            <div class="letter-body">
              <div class="typewriter-text" id="typewriterText"></div>
            </div>
            <div class="letter-signature" id="letterSignature"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const CONFIG = {
        greetingText: "Chào người đẹp! 💖",
        messages: {
          friend:
            "Chúc cho các chị em có một ngày 20/10 thật là vui, thật là vẻ, thật là hạnh và thật là phúc — luôn rạng rỡ nụ cười, tràn đầy yêu thương và nhận được thật nhiều điều ngọt ngào trong cuộc sống. 💐Chúc các chị em luôn xinh đẹp, rạng rỡ và hạnh phúc. Mong ngày 20/10 tràn đầy niềm vui, yêu thương và thật nhiều điều ngọt ngào bên người thân yêu!",
          mother:
            "💗 Mẹ ơi, con chúc mẹ luôn mạnh khỏe, an yên và mỉm cười thật nhiều, cảm ơn mẹ vì đã dành cả yêu thương để nuôi con nên người 💝",
          crush:
            "💞 Hôm nay 20/10, em chúc chị thật vui vẻ, sau này luôn luôn hạnh phúc, cuộc sống không còn chút tiêu cực nào và nhớ giữ gìn sức khỏe và đặc biệt là ngày càng xinh xắn, dễ thương hơn nhé 💐",
        },
        typeSpeed: 30,
        heartsCount: 15,
        flowersCount: 15,
        lightParticlesCount: 20,
      };

      let hasOpened = false;
      let isMuted = false;
      let bgMusic;

      const params = new URLSearchParams(window.location.search);
      const ENCODED_TYPES = {
        a4f7b2e193c64a89b013c9d1b4d6c8a5: "friend",
        b8e5a1d973c44f72a019f3a6b8c7e2d4: "mother",
        c9f2d4a683b71a58e6a5d8b9f1e2c7a3: "crush",
      };

      const TYPE_TO_CODE = Object.fromEntries(
        Object.entries(ENCODED_TYPES).map(([k, v]) => [v, k])
      );

      function detectMessageType() {
        const params = new URLSearchParams(window.location.search);
        const code = (params.get("t") || "").trim().toLowerCase();
        const messageType = ENCODED_TYPES[code] || "friend";
        if (!code || !ENCODED_TYPES[code]) {
          const newUrl = `${window.location.pathname}?t=${TYPE_TO_CODE[messageType]}`;
          window.history.replaceState({}, "", newUrl);
        }
        return messageType;
      }
      const messageType = detectMessageType();
      let openSound, closeSound;

      function setupAudio() {
        bgMusic = new Audio();
        bgMusic.loop = true;
        bgMusic.volume = 0;
        bgMusic.src = "sound.mp3";
        bgMusic.addEventListener("canplay", () => {
          if (!isMuted) playBackgroundMusic();
        });

        openSound = () => {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          oscillator.frequency.value = 800;
          oscillator.type = "sine";
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.5
          );
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.5);
        };

        closeSound = () => {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          oscillator.frequency.value = 600;
          oscillator.type = "sine";
          gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.3
          );
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.3);
        };
      }

      function playBackgroundMusic() {
        if (bgMusic && !isMuted) {
          bgMusic.play().catch(() => {});
          gsap.to(bgMusic, { volume: 0.3, duration: 2, ease: "power2.inOut" });
        }
      }

      function stopBackgroundMusic() {
        if (bgMusic) {
          gsap.to(bgMusic, {
            volume: 0,
            duration: 1,
            ease: "power2.inOut",
            onComplete: () => bgMusic.pause(),
          });
        }
      }

      function createLightParticles(container, count) {
        for (let i = 0; i < count; i++) {
          const particle = document.createElement("div");
          particle.className = "light-particle";
          particle.style.left = gsap.utils.random(0, 100) + "%";
          particle.style.top = gsap.utils.random(0, 100) + "%";
          container.appendChild(particle);
          gsap.to(particle, {
            y: gsap.utils.random(-50, 50),
            x: gsap.utils.random(-50, 50),
            opacity: gsap.utils.random(0.3, 1),
            scale: gsap.utils.random(0.5, 1.5),
            duration: gsap.utils.random(3, 6),
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: gsap.utils.random(0, 3),
          });
        }
      }

      function createSparkles(x, y, count = 8) {
        for (let i = 0; i < count; i++) {
          const sparkle = document.createElement("div");
          Object.assign(sparkle.style, {
            position: "fixed",
            width: "6px",
            height: "6px",
            background: "radial-gradient(circle, #fff, #ffd700)",
            borderRadius: "50%",
            pointerEvents: "none",
            zIndex: "150",
            left: x + "px",
            top: y + "px",
            boxShadow: "0 0 10px #ffd700",
          });
          document.body.appendChild(sparkle);
          const angle = (Math.PI * 2 * i) / count;
          const distance = gsap.utils.random(30, 60);
          gsap.to(sparkle, {
            x: Math.cos(angle) * distance,
            y: Math.sin(angle) * distance - 20,
            opacity: 0,
            scale: 0,
            duration: 0.8,
            ease: "power2.out",
            onComplete: () => sparkle.remove(),
          });
        }
      }

      function showThankYou() {
        const thankYou = document.getElementById("thankYou");
        for (let i = 0; i < 12; i++) {
          setTimeout(() => {
            const heart = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "svg"
            );
            heart.setAttribute("viewBox", "-12 -12 24 24");
            heart.setAttribute("width", "20");
            heart.setAttribute("height", "20");
            Object.assign(heart.style, {
              position: "fixed",
              left: "50%",
              top: "50%",
              pointerEvents: "none",
              zIndex: "160",
            });
            const path = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "path"
            );
            path.setAttribute(
              "d",
              "M 0,-6 C -3,-9 -8,-9 -10,-6 C -12,-3 -12,0 -10,3 L 0,12 L 10,3 C 12,0 12,-3 10,-6 C 8,-9 3,-9 0,-6 Z"
            );
            path.setAttribute("fill", "#ff5a8b");
            heart.appendChild(path);
            document.body.appendChild(heart);
            const angle = (Math.PI * 2 * i) / 12;
            const distance = gsap.utils.random(100, 200);
            gsap.to(heart, {
              x: Math.cos(angle) * distance,
              y: Math.sin(angle) * distance,
              rotation: gsap.utils.random(-360, 360),
              opacity: 0,
              scale: 2,
              duration: 1.5,
              ease: "power2.out",
              onComplete: () => heart.remove(),
            });
          }, i * 50);
        }
        gsap
          .timeline()
          .to(thankYou, {
            y: 30,
            opacity: 1,
            scale: 1,
            duration: 0.8,
            ease: "back.out(1.7)",
          })
          .to(thankYou, {
            opacity: 0,
            scale: 0.9,
            duration: 0.8,
            delay: 2,
            ease: "power2.in",
          });
      }

      function spawnHearts(container, count) {
        const heartPath =
          "M 0,-6 C -3,-9 -8,-9 -10,-6 C -12,-3 -12,0 -10,3 L 0,12 L 10,3 C 12,0 12,-3 10,-6 C 8,-9 3,-9 0,-6 Z";

        for (let i = 0; i < count; i++) {
          const heart = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "svg"
          );
          heart.classList.add("heart");
          heart.setAttribute("viewBox", "-12 -12 24 24");
          const size = gsap.utils.random(15, 35);
          heart.setAttribute("width", size);
          heart.setAttribute("height", size);

          const path = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "path"
          );
          path.setAttribute("d", heartPath);

          const colors = ["#ff5a8b", "#ff8fab", "#ffb3c6", "#ffc0d3"];
          path.setAttribute("fill", gsap.utils.random(colors));

          heart.appendChild(path);
          heart.style.left = gsap.utils.random(0, 100) + "%";
          heart.style.top = "110%";

          container.appendChild(heart);

          gsap.to(heart, {
            y: -window.innerHeight - 200,
            x: gsap.utils.random(-150, 150),
            rotation: gsap.utils.random(-360, 360),
            opacity: 0.9,
            duration: gsap.utils.random(12, 20),
            delay: gsap.utils.random(0, 15),
            ease: "none",
            repeat: -1,
            onRepeat: function () {
              gsap.set(heart, {
                y: 0,
                x: 0,
                left: gsap.utils.random(0, 100) + "%",
              });
            },
          });

          if (Math.random() > 0.5) {
            gsap.to(heart, {
              scale: 1.15,
              duration: 2,
              ease: "sine.inOut",
              repeat: -1,
              yoyo: true,
              delay: gsap.utils.random(0, 2),
            });
          }
        }
      }

      function spawnFlowers(container, count) {
        const flowerTypes = [
          `<svg viewBox="0 0 40 40" width="40" height="40">
          <g transform="translate(20, 20)">
            <circle r="3" fill="#FFD700"/>
            ${[0, 45, 90, 135, 180, 225, 270, 315]
              .map(
                (angle) =>
                  `<path d="M 0,-8 Q -2,-10 -4,-8 Q -2,-6 0,-8 Z" fill="#FFB6C1" opacity="0.9" transform="rotate(${angle})"/>`
              )
              .join("")}
          </g>
        </svg>`,
          `<svg viewBox="0 0 40 40" width="35" height="35">
          <g transform="translate(20, 20)">
            <circle r="8" fill="#FF6B9D" opacity="0.8"/>
            <circle r="5" fill="#FF8FAB" opacity="0.9"/>
            <circle r="3" fill="#FFA5BA" opacity="0.9"/>
          </g>
        </svg>`,
        ];

        for (let i = 0; i < count; i++) {
          const flower = document.createElement("div");
          flower.classList.add("flower");
          flower.innerHTML = gsap.utils.random(flowerTypes);

          const positions = [
            {
              left: gsap.utils.random(0, 10) + "%",
              top: gsap.utils.random(0, 100) + "%",
            },
            {
              right: gsap.utils.random(0, 10) + "%",
              top: gsap.utils.random(0, 100) + "%",
            },
            {
              top: gsap.utils.random(0, 10) + "%",
              left: gsap.utils.random(0, 100) + "%",
            },
            {
              bottom: gsap.utils.random(0, 10) + "%",
              left: gsap.utils.random(0, 100) + "%",
            },
          ];

          const pos = gsap.utils.random(positions);
          Object.assign(flower.style, pos);

          container.appendChild(flower);

          gsap.fromTo(
            flower,
            {
              opacity: 0,
              scale: 0,
              rotation: gsap.utils.random(-180, 180),
            },
            {
              opacity: 0.8,
              scale: 1,
              rotation: gsap.utils.random(180, 540),
              duration: 1.5,
              delay: i * 0.1,
              ease: "back.out(1.7)",
            }
          );
        }
      }

      function createConfettiBurst(x, y) {
        const colors = [
          "#ff5a8b",
          "#ff8fab",
          "#ffa8c5",
          "#ffc0cb",
          "#ffb6d9",
          "#ffd4e5",
        ];
        const count = 40;

        for (let i = 0; i < count; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = x + "px";
          confetti.style.top = y + "px";
          confetti.style.background = gsap.utils.random(colors);
          confetti.style.borderRadius = Math.random() > 0.5 ? "50%" : "2px";
          document.body.appendChild(confetti);

          const angle = (Math.PI * 2 * i) / count;
          const velocity = gsap.utils.random(150, 300);

          gsap.to(confetti, {
            x: Math.cos(angle) * velocity,
            y: Math.sin(angle) * velocity + 300,
            rotation: gsap.utils.random(0, 1080),
            opacity: 0,
            duration: gsap.utils.random(1.5, 2.5),
            ease: "power2.out",
            onComplete: () => confetti.remove(),
          });
        }
      }

      function createParticleBurst(x, y) {
        const container = document.getElementById("particlesContainer");
        const count = 25;

        for (let i = 0; i < count; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = x + "px";
          particle.style.top = y + "px";
          particle.style.background = `radial-gradient(circle, #ff5a8b 0%, transparent 70%)`;
          container.appendChild(particle);

          const angle = (Math.PI * 2 * i) / count;
          const distance = gsap.utils.random(80, 150);

          gsap.to(particle, {
            x: Math.cos(angle) * distance,
            y: Math.sin(angle) * distance,
            scale: 0,
            opacity: 1,
            duration: 1.5,
            ease: "power2.out",
            onComplete: () => particle.remove(),
          });

          gsap.to(particle, {
            opacity: 0,
            duration: 1,
            delay: 0.5,
          });
        }
      }

      function showGreeting() {
        const greeting = document.getElementById("greetingText");
        greeting.textContent = CONFIG.greetingText;

        const tl = gsap.timeline();
        tl.to(greeting, {
          opacity: 1,
          scale: 1,
          duration: 1,
          ease: "back.out(1.7)",
        }).to(greeting, {
          opacity: 0,
          scale: 0.9,
          duration: 0.5,
          delay: 1,
          ease: "power2.in",
        });
      }

      function showBicycle() {
        const bicycle = document.getElementById("bicycleContainer");
        const isMobile = window.innerWidth <= 768;
        const bicycleWidth = bicycle.offsetWidth;
        const initialLeft = bicycle.offsetLeft;

        if (isMobile) {
          // Mobile: hiển thị xe ở giữa màn hình rồi tắt sau 3 giây
          gsap.set(bicycle, {
            opacity: 1,
            x: window.innerWidth / 2 - bicycleWidth / 2 - initialLeft,
          });
          showGreeting();

          gsap.to(bicycle, {
            opacity: 0,
            duration: 3,
            ease: "power2.in",
          });
        } else {
          // Desktop: animation đầy đủ
          const tl = gsap.timeline();
          tl.to(bicycle, {
            opacity: 1,
            x: window.innerWidth / 2 + 150 - initialLeft,
            duration: 4,
            ease: "power2.inOut",
          })
            .call(showGreeting, null, "-=1")
            .to(bicycle, {
              x: window.innerWidth + 300,
              opacity: 0,
              duration: 2,
              delay: 0.5,
              ease: "power2.in",
            });

          return tl;
        }
      }

      function openEnvelope() {
        if (hasOpened) return;
        hasOpened = true;

        if (bgMusic.paused && !isMuted) {
          bgMusic.play().catch(() => {});
        }
        if (openSound) openSound();

        const flap = document.getElementById("envelopeFlap");
        const wrapper = document.getElementById("envelopeWrapper");
        const button = document.getElementById("openButton");
        const mainContainer = document.getElementById("mainContainer");
        const cardOverlay = document.getElementById("cardOverlay");
        const largeCard = document.getElementById("largeCard");
        const heartsContainer = document.getElementById("heartsContainer");
        const hintText = document.getElementById("hintText");

        const buttonRect = button.getBoundingClientRect();

        createSparkles(
          buttonRect.left + buttonRect.width / 2,
          buttonRect.top + buttonRect.height / 2,
          12
        );

        const wrapperRect = wrapper.getBoundingClientRect();
        createParticleBurst(
          wrapperRect.left + wrapperRect.width / 2,
          wrapperRect.top + wrapperRect.height / 2
        );

        createConfettiBurst(
          buttonRect.left + buttonRect.width / 2,
          buttonRect.top + buttonRect.height / 2
        );

        const tl = gsap.timeline();

        tl.to(hintText, {
          opacity: 0,
          y: -10,
          duration: 0.3,
          ease: "power2.in",
        });

        tl.to(
          button,
          {
            opacity: 0,
            scale: 0.8,
            duration: 0.4,
            ease: "power2.in",
          },
          "-=0.2"
        );

        tl.to(
          wrapper,
          {
            rotation: 3,
            yoyo: true,
            repeat: 5,
            duration: 0.08,
            ease: "power1.inOut",
          },
          "-=0.2"
        ).to(wrapper, {
          rotation: 0,
          duration: 0.3,
        });

        tl.to(
          flap,
          {
            rotateX: 180,
            duration: 1.2,
            ease: "back.out(1.2)",
            transformOrigin: "top center",
          },
          "-=0.3"
        );

        tl.to(
          heartsContainer,
          {
            opacity: 0.3,
            duration: 0.5,
          },
          "-=0.8"
        );

        tl.to(
          mainContainer,
          {
            scale: 0.5,
            opacity: 0,
            duration: 0.8,
            ease: "power2.in",
          },
          "-=0.3"
        );

        tl.set(cardOverlay, {
          zIndex: 100,
          pointerEvents: "auto",
        }).to(cardOverlay, {
          opacity: 1,
          background: "rgba(0, 0, 0, 0.4)",
          duration: 0.6,
          ease: "power2.out",
        });

        tl.to(
          largeCard,
          {
            opacity: 1,
            scale: 1,
            duration: 0.8,
            ease: "back.out(1.2)",
            onComplete: () => {
              spawnFlowers(
                document.getElementById("flowersContainer"),
                CONFIG.flowersCount
              );
              setTimeout(() => {
                typewriter(
                  document.getElementById("typewriterText"),
                  CONFIG.messages[messageType],
                  CONFIG.typeSpeed
                );
              }, 500);
            },
          },
          "-=0.4"
        );

        tl.to("#closeButton", {
          opacity: 1,
          duration: 0.5,
          delay: 1,
        }).to(
          "#shareButton",
          {
            opacity: 1,
            y: 0,
            duration: 0.6,
            ease: "back.out(1.7)",
          },
          "-=0.3"
        );
      }

      function closeCard() {
        if (closeSound) closeSound();

        const cardOverlay = document.getElementById("cardOverlay");
        const largeCard = document.getElementById("largeCard");
        const mainContainer = document.getElementById("mainContainer");
        const heartsContainer = document.getElementById("heartsContainer");
        const wrapper = document.getElementById("envelopeWrapper");
        const flap = document.getElementById("envelopeFlap");
        const button = document.getElementById("openButton");
        const hintText = document.getElementById("hintText");

        showThankYou();

        const tl = gsap.timeline();

        tl.to("#shareButton", {
          opacity: 0,
          y: 20,
          duration: 0.3,
          ease: "power2.in",
        });

        tl.to(
          largeCard,
          {
            opacity: 0,
            scale: 0.5,
            duration: 0.4,
            ease: "power2.in",
          },
          "-=0.2"
        );

        tl.to(
          cardOverlay,
          {
            opacity: 0,
            background: "rgba(0, 0, 0, 0)",
            duration: 0.5,
            ease: "power2.in",
            onComplete: () => {
              gsap.set(cardOverlay, {
                zIndex: -1,
                pointerEvents: "none",
              });
            },
          },
          "-=0.2"
        );

        tl.to(
          mainContainer,
          {
            scale: 1,
            opacity: 1,
            duration: 0.8,
            ease: "back.out(1.2)",
          },
          "-=0.3"
        );

        tl.to(
          heartsContainer,
          {
            opacity: 1,
            duration: 0.5,
          },
          "-=0.5"
        );

        tl.to(
          flap,
          {
            rotateX: 0,
            duration: 0.8,
            ease: "power2.out",
          },
          "-=0.6"
        );

        tl.to(
          button,
          {
            opacity: 1,
            scale: 1,
            duration: 0.5,
            ease: "back.out(1.7)",
          },
          "-=0.3"
        ).to(
          hintText,
          {
            opacity: 1,
            y: 0,
            duration: 0.5,
            ease: "back.out(1.7)",
          },
          "-=0.3"
        );

        tl.add(() => {
          document.getElementById("typewriterText").textContent = "";
          document.getElementById("flowersContainer").innerHTML = "";
          gsap.to("#closeButton", { opacity: 0, duration: 0 });
          gsap.to("#shareButton", { opacity: 0, y: 20, duration: 0 });
          hasOpened = false;
        });
      }

      function typewriter(element, text, speed) {
        // Xoá text cũ trước khi gõ lại
        element.textContent = "";

        // Xoá con trỏ cũ nếu có
        const oldCursor = document.getElementById("cursor");
        if (oldCursor) oldCursor.remove();

        // Tạo con trỏ mới
        const cursor = document.createElement("span");
        cursor.id = "cursor";
        cursor.className = "cursor";
        element.parentNode.appendChild(cursor);

        let index = 0;

        gsap.to(cursor, {
          opacity: 0,
          duration: 0.4,
          repeat: -1,
          yoyo: true,
          ease: "steps(1)",
        });

        function type() {
          if (index < text.length) {
            const char = text.charAt(index);
            if (char === "\n") {
              element.innerHTML += "<br>";
            } else {
              element.textContent += char;
            }

            index++;

            // Tạm dừng lâu hơn nếu gặp dấu câu
            const pauseChars = [".", "!", "?", ",", "…"];
            const isPause = pauseChars.includes(char);
            const nextDelay = isPause ? speed * 10 : speed;

            setTimeout(type, nextDelay);
          } else {
            // Dừng con trỏ khi gõ xong
            gsap.killTweensOf(cursor);
            cursor.style.display = "none";
          }
        }

        type();
      }

      function setupEnvelopeHover() {
        const wrapper = document.getElementById("envelopeWrapper");
        const glow = document.getElementById("envelopeGlow");

        wrapper.addEventListener("mouseenter", () => {
          if (!hasOpened) {
            gsap.to(wrapper, {
              scale: 1.05,
              y: -8,
              rotation: 2,
              duration: 0.4,
              ease: "power2.out",
            });

            gsap.to(glow, {
              opacity: 1,
              scale: 1.15,
              duration: 0.4,
            });

            const heartSeal = document.querySelector("#heartSeal circle");
            if (heartSeal) {
              gsap.to(heartSeal, {
                attr: { r: 20 },
                duration: 0.6,
                ease: "sine.inOut",
                yoyo: true,
                repeat: -1,
              });
            }
          }
        });

        wrapper.addEventListener("mouseleave", () => {
          if (!hasOpened) {
            gsap.to(wrapper, {
              scale: 1,
              y: 0,
              rotation: 0,
              duration: 0.4,
              ease: "power2.out",
            });

            gsap.to(glow, {
              opacity: 0.7,
              scale: 1,
              duration: 0.4,
            });

            const heartSeal = document.querySelector("#heartSeal circle");
            if (heartSeal) {
              gsap.killTweensOf(heartSeal);
              gsap.to(heartSeal, {
                attr: { r: 18 },
                duration: 0.3,
              });
            }
          }
        });
      }

      function setupButtonHover() {
        const button = document.getElementById("openButton");

        button.addEventListener("mouseenter", () => {
          if (!hasOpened) {
            gsap.to(button, {
              y: -5,
              scale: 1.05,
              duration: 0.3,
              ease: "power2.out",
            });

            for (let i = 0; i < 8; i++) {
              setTimeout(() => {
                const sparkle = document.createElement("div");
                sparkle.style.position = "fixed";
                sparkle.style.width = "8px";
                sparkle.style.height = "8px";
                sparkle.style.background =
                  "radial-gradient(circle, #fff, #ffd700)";
                sparkle.style.borderRadius = "50%";
                sparkle.style.pointerEvents = "none";
                sparkle.style.zIndex = "15";
                sparkle.style.boxShadow = "0 0 10px #ffd700";

                const buttonRect = button.getBoundingClientRect();
                sparkle.style.left =
                  buttonRect.left +
                  buttonRect.width / 2 +
                  gsap.utils.random(-50, 50) +
                  "px";
                sparkle.style.top =
                  buttonRect.top +
                  buttonRect.height / 2 +
                  gsap.utils.random(-50, 50) +
                  "px";
                document.body.appendChild(sparkle);

                gsap.to(sparkle, {
                  y: -50,
                  opacity: 0,
                  scale: 0,
                  duration: 0.8,
                  ease: "power2.out",
                  onComplete: () => sparkle.remove(),
                });
              }, i * 100);
            }
          }
        });

        button.addEventListener("mouseleave", () => {
          if (!hasOpened) {
            gsap.to(button, {
              y: 0,
              scale: 1,
              duration: 0.3,
              ease: "power2.out",
            });
          }
        });
      }

      function shareCard() {
        const url = window.location.href;

        if (navigator.share) {
          navigator
            .share({
              title: "Thiệp Chúc Mừng 20/10 💕",
              text: "Gửi bạn một thiệp chúc mừng đầy yêu thương! 💖",
              url: url,
            })
            .catch(() => {
              copyToClipboard(url);
            });
        } else {
          copyToClipboard(url);
        }
      }

      function copyToClipboard(text) {
        if (navigator.clipboard) {
          navigator.clipboard.writeText(text).then(() => {
            showCopyNotification();
          });
        } else {
          const textarea = document.createElement("textarea");
          textarea.value = text;
          textarea.style.position = "fixed";
          textarea.style.opacity = "0";
          document.body.appendChild(textarea);
          textarea.select();
          try {
            document.execCommand("copy");
            showCopyNotification();
          } catch (err) {
            alert("Không thể sao chép link. Vui lòng thử lại!");
          }
          document.body.removeChild(textarea);
        }
      }

      function showCopyNotification() {
        const notification = document.createElement("div");
        notification.textContent = "✅ Đã sao chép link!";
        notification.style.position = "fixed";
        notification.style.top = "20px";
        notification.style.left = "50%";
        notification.style.transform = "translateX(-50%)";
        notification.style.padding = "12px 24px";
        notification.style.background =
          "linear-gradient(135deg, #ff5a8b, #ff8fab)";
        notification.style.color = "white";
        notification.style.borderRadius = "30px";
        notification.style.fontFamily = "'Quicksand', sans-serif";
        notification.style.fontWeight = "600";
        notification.style.fontSize = "14px";
        notification.style.boxShadow = "0 8px 20px rgba(255, 90, 139, 0.4)";
        notification.style.zIndex = "300";
        notification.style.opacity = "0";
        document.body.appendChild(notification);

        gsap
          .timeline()
          .to(notification, {
            opacity: 1,
            y: 20,
            duration: 0.5,
            ease: "back.out(1.7)",
          })
          .to(notification, {
            opacity: 0,
            y: 0,
            duration: 0.4,
            delay: 2,
            ease: "power2.in",
            onComplete: () => notification.remove(),
          });
      }

      function toggleMusic() {
        isMuted = !isMuted;
        const toggle = document.getElementById("musicToggle");
        toggle.textContent = isMuted ? "🔇" : "🎵";
        toggle.classList.toggle("muted", isMuted);

        if (isMuted) {
          stopBackgroundMusic();
        } else {
          playBackgroundMusic();
        }

        gsap.to(toggle, {
          scale: 1.2,
          duration: 0.2,
          yoyo: true,
          repeat: 1,
          ease: "power2.inOut",
        });
      }

      function animateBackground() {
        const bg = document.querySelector(".background");
        gsap.to(bg, {
          backgroundPosition: "100% 50%",
          duration: 15,
          repeat: -1,
          yoyo: true,
          ease: "sine.inOut",
        });
      }

      function animateGlow() {
        const glow = document.getElementById("envelopeGlow");
        gsap.to(glow, {
          opacity: 1,
          scale: 1.12,
          duration: 3.5,
          repeat: -1,
          yoyo: true,
          ease: "sine.inOut",
        });
      }

      function changeMessageType() {
        const select = document.getElementById("messageTypeSelect");
        messageType = select.value;
      }

      document.addEventListener("DOMContentLoaded", () => {
        // 🌸 Xác định loại thiệp theo query string (?type=friend|mother|crush)

        function getShareLink(currentType) {
          const code = TYPE_TO_CODE[currentType] || TYPE_TO_CODE["friend"];
          return `${window.location.origin}${window.location.pathname}?t=${code}`;
        }

        const THEME_COLORS = {
          friend: {
            gradient: ["#a7e8f0", "#c2f0d1", "#e3f8ff"], // xanh bạc hà & trắng nhẹ
            main: "#4fa3d1", // xanh trời nhẹ
            accent: "#7cd1b8", // xanh mint dịu
            text: "#4fa3d1", // chữ tối dễ đọc
          },
          mother: {
            gradient: ["#fff0f5", "#ffe6eb", "#ffd8e1"], // hồng phấn sáng
            main: "#ff8ba7", // hồng đào
            accent: "#ffc6d9", // hồng pastel
            text: "#e75480", // hồng đậm để tương phản
          },
          crush: {
            main: "#ffc2d1", // Màu chính (hồng đậm, nổi bật, dùng cho nút hoặc tiêu đề)
            gradient: ["#ff7a9e", "#ff8fb1", "#ffc2d1"], // Dải màu nền gradient (ngọt ngào, dịu dần)
            accent: "#ff4d6d", // Màu phụ (hồng phấn nhẹ, dùng cho hover, icon, viền, v.v.)
            text: "#ff4d6d", // Màu chữ (trắng, nổi bật trên nền hồng)
          },
        };

        // 🌈 Áp dụng toàn bộ theme
        function applyFullTheme(type) {
          const { main, accent, gradient, text } =
            THEME_COLORS[type] || THEME_COLORS.friend;

          // 🌄 Nền tổng thể
          const bg = document.querySelector(".background");
          if (bg)
            bg.style.background = `linear-gradient(135deg, ${gradient[0]} 0%, ${gradient[1]} 50%, ${gradient[2]} 100%)`;

          // 🌟 Cập nhật biến CSS
          document.documentElement.style.setProperty("--main-color", main);
          document.documentElement.style.setProperty("--accent-color", accent);
          document.documentElement.style.setProperty("--text-color", text);

          // 💌 Envelope flap + body
          const flap = document.getElementById("envelopeFlap");
          if (flap) flap.style.background = flap.style.fill = main;
          const body = document.getElementById("envelopeBody");
          if (body) {
            body.style.borderColor = accent;
            body.style.boxShadow = `0 4px 20px ${main}44`;
          }

          // ✨ Các nút (open, close, share)
          document.querySelectorAll("button").forEach((btn) => {
            btn.style.background = `linear-gradient(135deg, ${main}, ${accent})`;
            btn.style.color = "#fff";
            btn.style.borderColor = main;
            btn.style.boxShadow = `0 8px 25px ${main}55`;
          });

          // 💫 SVG và hiệu ứng bay
          document
            .querySelectorAll("svg path, svg circle, .large-card")
            .forEach((el) => {
              if (["path", "circle"].includes(el.tagName)) {
                el.setAttribute("stroke", main);
                el.setAttribute("fill", main);
              } else {
                el.style.boxShadow = `0 15px 50px ${main}44`;
                el.style.borderColor = accent;
              }
            });

          document.querySelectorAll(".floating-icon, .heart").forEach((el) => {
            el.style.color = main;
            el.style.opacity = 0.9;
          });

          // 🌈 Màu chữ toàn bộ text chính
          document
            .querySelectorAll(
              ".greeting-text, .hint-text, .thank-you, .typewriter-text, .open-button span, .close-button, .share-button"
            )
            .forEach((el) => {
              el.style.color = text;
            });

          // 💬 Cập nhật nội dung chữ cho từng theme
          const greeting = document.getElementById("greetingText");
          const hint = document.getElementById("hintText");
          const openButton = document.getElementById("openButton");
          const thankYou = document.getElementById("thankYou");

          const titles =
            {
              friend: {
                greet: "Hey bạn thân! 💙",
                hint: "🌈 Có điều bất ngờ nhỏ xíu dành cho bạn đó! ⭐<br>💬 Hãy mở thư để xem nhé 💌",
                btn: "✨ Mở Thư Nhé ✨",
                thanks: "💙 Cảm ơn bạn đáng yêu 💙",
                title: "Thiệp Cho Bạn Thân 💙",
              },
              mother: {
                greet: "Gửi Mẹ Yêu 💐",
                hint: "🌸 Có vài dòng nhỏ con muốn gửi mẹ 🌸<br>💝 Hãy mở thư và đọc nhé 💕",
                btn: "💗 Mở Thư 💗",
                thanks: "Con yêu mẹ nhiều",
                title: "Thiệp Cho Mẹ 💗",
              },
              crush: {
                greet: "Chào người làm tim anh loạn nhịp 💞",
                hint: "💖 Có điều nhỏ em muốn nói... 💌<br>🌷 Hãy mở thư nhé 🌷",
                btn: "💞 Mở Thư 💞",
                thanks: "Cảm ơn chị đã đọc",
                title: "Thiệp Cho 💞",
              },
            }[type] || {};
          const letterHeader = document.getElementById("letterHeader");
          const letterSignature = document.getElementById("letterSignature");
          console.log(type);
          if (letterHeader && letterSignature) {
            if (type === "friend") {
              letterHeader.innerHTML =
                "<span>Chúc mừng ngày phụ nữ Việt Nam 💙</span>";
              letterSignature.innerHTML = "Nguyên";
            } else if (type === "mother") {
              letterHeader.innerHTML = "<span>Gửi Mẹ Yêu 💐</span>";
              letterSignature.innerHTML = "Nguyên";
            } else if (type === "crush") {
              letterHeader.innerHTML = "<span>Hé nhô 🌷</span>";
              letterSignature.innerHTML = "Nguyên";
            }

            const span = letterHeader.querySelector("span");
            if (span) {
              span.style.color = "var(--text-color)";
              span.style.fontWeight = "600";
            }
          }

          const letterBody = document.getElementById("typewriterText");
          console.log(titles.message);
          if (letterBody && titles.message) {
            letterBody.innerHTML = titles.message;
          }

          if (greeting) greeting.textContent = titles.greet || "Gửi lời yêu 💌";
          if (hint) hint.innerHTML = titles.hint || "💬 Mở thư để xem nhé!";
          if (openButton)
            openButton.innerHTML = `<span>${
              titles.btn || "💌 Mở Thư 💌"
            }</span>`;
          if (thankYou)
            thankYou.textContent = titles.thanks || "💖 Cảm ơn bạn 💖";
          document.title = titles.title || "Thiệp Dễ Thương 💌";

          // 🌈 Hiệu ứng chuyển mượt
          document
            .querySelectorAll(
              ".background, button, .greeting-text, .hint-text, .thank-you, .typewriter-text"
            )
            .forEach((el) => {
              el.style.transition = "all 1s ease-in-out";
            });
        }

        // 🚀 Gọi 1 hàm duy nhất

        applyFullTheme(messageType);
        setupAudio();
        spawnHearts(
          document.getElementById("heartsContainer"),
          CONFIG.heartsCount
        );
        createLightParticles(
          document.getElementById("particlesBg"),
          CONFIG.lightParticlesCount
        );
        animateBackground();
        animateGlow();

        const mainTimeline = gsap.timeline();

        mainTimeline.add(() => {
          showBicycle();
        }, 0.8);

        mainTimeline
          .to(
            "#mainContainer",
            {
              opacity: 1,
              pointerEvents: "auto",
              duration: 1.2,
              ease: "power2.out",
            },
            8
          )
          .to(
            "#hintText",
            {
              opacity: 1,
              y: 0,
              duration: 0.8,
              ease: "back.out(1.7)",
            },
            "-=0.5"
          )
          .to(
            "#musicToggle",
            {
              opacity: 1,
              duration: 0.5,
            },
            "-=0.3"
          )
          .to(
            "#messageSelector",
            {
              opacity: 1,
              duration: 0.5,
            },
            "-=0.3"
          );

        gsap.to("#hintText", {
          y: -5,
          duration: 2,
          repeat: -1,
          yoyo: true,
          ease: "sine.inOut",
          delay: 10,
        });

        setupEnvelopeHover();
        setupButtonHover();

        const envelopeWrapper = document.getElementById("envelopeWrapper");
        const openButton = document.getElementById("openButton");
        const closeButton = document.getElementById("closeButton");
        const shareButton = document.getElementById("shareButton");
        const musicToggle = document.getElementById("musicToggle");
        const cardOverlay = document.getElementById("cardOverlay");
        const messageTypeSelect = document.getElementById("messageTypeSelect");

        envelopeWrapper.addEventListener("click", openEnvelope);
        openButton.addEventListener("click", openEnvelope);
        closeButton.addEventListener("click", closeCard);
        shareButton.addEventListener("click", shareCard);
        musicToggle.addEventListener("click", toggleMusic);
        messageTypeSelect.addEventListener("change", changeMessageType);

        cardOverlay.addEventListener("click", (e) => {
          if (e.target === cardOverlay) {
            closeCard();
          }
        });

        envelopeWrapper.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openEnvelope();
          }
        });

        openButton.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openEnvelope();
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && hasOpened) {
            closeCard();
          }
        });

        shareButton.addEventListener("mouseenter", () => {
          gsap.to(shareButton, {
            scale: 1.05,
            y: -3,
            duration: 0.3,
            ease: "power2.out",
          });
        });

        shareButton.addEventListener("mouseleave", () => {
          gsap.to(shareButton, {
            scale: 1,
            y: 0,
            duration: 0.3,
            ease: "power2.out",
          });
        });
      });
    </script>
  </body>
</html>
